package core

import (
	"encoding/json"
	"github.com/Zilliqa/gozilliqa-sdk/util"
	"io/ioutil"
	"strings"
	"testing"
)

func Test_DeserializeFromJsonToTxBlockT(t *testing.T) {
	txJson, err := ioutil.ReadFile("txblock.json")
	if err != nil {
		t.Fatal(err.Error())
	}

	var txBlockT TxBlockT
	err2 := json.Unmarshal(txJson, &txBlockT)
	if err2 != nil {
		t.Fatal(err2.Error())
	}

	t.Log(txBlockT)

	txBlockHeader := NewTxBlockHeaderFromTxBlockT(&txBlockT)
	headerBytes := txBlockHeader.Serialize()
	headerBytesString := strings.ToUpper(util.EncodeHex(headerBytes))
	t.Log(headerBytesString)
	if headerBytesString != "0A46080112204A458FF78CBC60B5D9CA9503BFFCF88E8042F2D787AB05B0958F4A5C472D4E271A204AA4D99C4B9C7A18D6EC3AA658EC96EF2E8170A19AE25F0B364A4711EADD51DD1090BF05180022120A100000000000000000000000000000000030033A660A20D2D85A130929A9F82A40F82B025B933628E7F77A514FFE0B80A20CC05AC17F33122000000000000000000000000000000000000000000000000000000000000000001A206929CA0C7380085057B053CB469CEC4C454C2D19E4B8DF4C7958D98960FEEEF940004A230A210200B7F73A5D4FB220EE73C2CB2C478E7CF70F6F8E8EEA5367BDCFCE265F6C0D295001" {
		t.Fail()
	}
}

func Test_DeserializeFromJsonToTxBlockT2(t *testing.T) {
	txJson, err := ioutil.ReadFile("txblock2.json")
	if err != nil {
		t.Fatal(err.Error())
	}

	var txBlockT TxBlockT
	err2 := json.Unmarshal(txJson, &txBlockT)
	if err2 != nil {
		t.Fatal(err2.Error())
	}

	t.Log(txBlockT)

	txBlockHeader := NewTxBlockHeaderFromTxBlockT(&txBlockT)
	headerBytes := txBlockHeader.Serialize()
	headerBytesString := strings.ToUpper(util.EncodeHex(headerBytes))
	t.Log(headerBytesString)
	if headerBytesString != "0A4608011220AA5764CC1646085C6DD2042BB784ED6A4E154D22F0D1D1DACDD9E86662601E071A201947718B431D25DD65C226F79F3E0A9CC96A948899DAB3422993DEF1494A9C951090BF05180022120A100000000000000000000000000000000030013A660A204853067D757551C7F0119786CC830770A5F6C4DEB0D90A0B6DA49CAD49966613122000000000000000000000000000000000000000000000000000000000000000001A201B447A8BBE57F5BD8A2B4E0EDF0BECB29BF928D007E7BB1F170754835A7AC9BE40794A230A210213D5A7F74B28F3F588FF6520748DBB541986E98F75FA78D6334B2D0AAB4C1E575001" {
		t.Fail()
	}
}
