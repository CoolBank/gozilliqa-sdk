/*
 * Copyright (C) 2021 Zilliqa
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
package core

import (
	"encoding/json"
	"github.com/Zilliqa/gozilliqa-sdk/util"
	"io/ioutil"
	"strings"
	"testing"
)

func Test_DeserializeFromJsonToDsBlockT(t *testing.T) {
	dsJson, err := ioutil.ReadFile("dsblock.json")
	if err != nil {
		t.Fatal(err.Error())
	}

	var dsBlockT DsBlockT
	err2 := json.Unmarshal(dsJson, &dsBlockT)
	if err2 != nil {
		t.Fatal(err2.Error())
	}

	dsBlockHeader := NewDsBlockHeaderFromDsBlockT(&dsBlockT)
	headerBytes := dsBlockHeader.Serialize()
	if "0A46080212205E0DBBA477EA36CCA0222CEB23E9B62262CDCDEB73BF2AB284C8C8B230D938371A206D3434708311D2F814279AA235B869A2DA45443FDCFAEE5625C5C60A1E297CA7100518032A230A210293F3A79C39A0C3952711B0F85440E9E5F96E4DC704AA431779ADEA817F12D8F23003380A42120A10000000000000000000000000773594004A320A30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000523D0A230A2103EEB8669191E26A163A9E3944B0150994CA04AD1CA7D0D9F1875AAE35148DD29312160A140000000000000000000000002E6C2A340000816D5AA5010A201F7A31292B4460E4F6559E684B37FBDE97CEB1C52CC23A4185F7EE612D1C447B1280010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000" != strings.ToUpper(util.EncodeHex(headerBytes)) {
		t.Fail()
	}

	dsJson1, err3 := ioutil.ReadFile("dsblock2.json")
	if err3 != nil {
		t.Fatal(err3.Error())
	}

	var dsBlockT1 DsBlockT
	err4 := json.Unmarshal(dsJson1, &dsBlockT1)
	if err4 != nil {
		t.Fatal(err4.Error())
	}

	dsBlockHeader1 := NewDsBlockHeaderFromDsBlockT(&dsBlockT1)
	headerBytes1 := dsBlockHeader1.Serialize()
	t.Log(strings.ToUpper(util.EncodeHex(headerBytes1)))
	if "0A4608021220AA5764CC1646085C6DD2042BB784ED6A4E154D22F0D1D1DACDD9E86662601E071A202888FA1F01AA2C8B1ADE1B254B19D93DAD56538E9234F218E1BC4C97FF424813100518032A230A210213D5A7F74B28F3F588FF6520748DBB541986E98F75FA78D6334B2D0AAB4C1E573004380F42120A10000000000000000000000000773594004A320A30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000523D0A230A210334AA0F7CA2EAA56B6B752533F9C60777E96C6D1ABE84B463F60ADD89843794AE12160A140000000000000000000000000A76DB220000816D5AA5010A20B0FE97D2028F734E895E45297A932F63CDEE08AF5EA25BCA732B24C15D759BAF128001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062230A2103AFEEA358BBFD6A350B59943E11D65386142033C63B921032608DE65334C1DF8C6A08086E1204080B1001" != strings.ToUpper(util.EncodeHex(headerBytes1)) {
		t.Fail()
	}

}
